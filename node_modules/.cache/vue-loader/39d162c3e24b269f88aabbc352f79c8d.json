{"remainingRequest":"D:\\work\\proj\\project_manage\\project-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\proj\\project_manage\\project-ui\\src\\views\\config\\bannerDetail.vue?vue&type=style&index=0&id=cd2dedc0&scoped=true&lang=css&","dependencies":[{"path":"D:\\work\\proj\\project_manage\\project-ui\\src\\views\\config\\bannerDetail.vue","mtime":1663479653275},{"path":"D:\\work\\proj\\project_manage\\project-ui\\node_modules\\css-loader\\dist\\cjs.js","mtime":1663230084856},{"path":"D:\\work\\proj\\project_manage\\project-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1663230088519},{"path":"D:\\work\\proj\\project_manage\\project-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":1663230086089},{"path":"D:\\work\\proj\\project_manage\\project-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1663230084016},{"path":"D:\\work\\proj\\project_manage\\project-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1663230087832}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLmJhbm5lci11cGxvYWQtcHJldmlldyB7DQogIGhlaWdodDogMTAwJTsNCiAgYm94LXNoYWRvdzogMCAwIDRweCAjY2NjOw0KICBvdmVyZmxvdzogaGlkZGVuOw0KDQp9DQo="},{"version":3,"sources":["bannerDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwVA;AACA;AACA;AACA;;AAEA","file":"bannerDetail.vue","sourceRoot":"src/views/config","sourcesContent":["<template>\r\n  <!-- 添加或修改轮播组件对话框 -->\r\n  <el-dialog\r\n    :title=\"title\"\r\n    :visible.sync=\"open\"\r\n    width=\"1480px\"\r\n    append-to-body\r\n    @close=\"closeDialog\"\r\n  >\r\n    <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\r\n      <el-row :gutter=\"20\">\r\n        <el-col\r\n          :xs=\"24\"\r\n          :md=\"12\"\r\n          :style=\"{ height: '720px', width:'1320px'}\"\r\n        >\r\n          <vue-cropper\r\n            ref=\"cropper\"\r\n            :img=\"options.img\"\r\n            :info=\"false\"\r\n            :autoCropWidth=\"options.autoCropWidth\"\r\n            :autoCropHeight=\"options.autoCropHeight\"\r\n            :fixedNumber=\"options.fixedNumber\"\r\n            :outputSize=\"1\"\r\n            :autoCrop=\"true\"\r\n            :fixed=\"true\"\r\n            :fixedBox=\"true\"\r\n            :infoTrue=\"true\"\r\n            @realTime=\"realTime\"\r\n          />\r\n        </el-col>\r\n        <el-col\r\n          :xs=\"24\"\r\n          :md=\"12\"\r\n          :style=\"{ height: '720px', width:'1320px'}\"\r\n        >\r\n          <div\r\n            class=\"banner-upload-preview\"\r\n          >\r\n            <img :src=\"previews.url\" :style=\"previews.img\" />\r\n          </div>\r\n        </el-col>\r\n      </el-row>\r\n      <br />\r\n      <el-row>\r\n        <el-col :lg=\"2\" :md=\"2\">\r\n          <el-upload\r\n            ref=\"uploadBanner\"\r\n            :http-request=\"httpRequest\"\r\n            accept=\"image/jpeg,image/gif,image/png\"\r\n            :file-lis=\"files\"\r\n            action=\"#\"\r\n            :show-file-list=\"false\"\r\n            :before-upload=\"beforeUpload\"\r\n          >\r\n            <el-button size=\"small\">\r\n              选择\r\n              <i class=\"el-icon-upload el-icon--right\"></i>\r\n            </el-button>\r\n          </el-upload>\r\n        </el-col>\r\n\r\n        <el-col :lg=\"{ span: 1, offset: 1 }\" :md=\"2\">\r\n          <el-button\r\n            icon=\"el-icon-plus\"\r\n            size=\"small\"\r\n            @click=\"changeScale(1)\"\r\n          ></el-button>\r\n        </el-col>\r\n        <el-col :lg=\"{ span: 1, offset: 1 }\" :md=\"2\">\r\n          <el-button\r\n            icon=\"el-icon-minus\"\r\n            size=\"small\"\r\n            @click=\"changeScale(-1)\"\r\n          ></el-button>\r\n        </el-col>\r\n        <el-col :lg=\"{ span: 1, offset: 1 }\" :md=\"2\">\r\n          <el-button\r\n            icon=\"el-icon-refresh-left\"\r\n            size=\"small\"\r\n            @click=\"rotateLeft()\"\r\n          ></el-button>\r\n        </el-col>\r\n        <el-col :lg=\"{ span: 1, offset: 1 }\" :md=\"2\">\r\n          <el-button\r\n            icon=\"el-icon-refresh-right\"\r\n            size=\"small\"\r\n            @click=\"rotateRight()\"\r\n          ></el-button>\r\n        </el-col>\r\n      </el-row>\r\n      <br />\r\n      <el-row>\r\n        <el-col :xs=\"24\" :md=\"12\">\r\n          <el-form-item label=\"显示顺序\" prop=\"orderNum\">\r\n            <el-input-number\r\n              v-model=\"form.orderNum\"\r\n              :min=\"1\"\r\n              style=\"width: 280px\"\r\n            />\r\n          </el-form-item>\r\n        </el-col>\r\n      </el-row>\r\n    </el-form>\r\n    <div slot=\"footer\" class=\"dialog-footer\">\r\n      <el-button type=\"primary\" @click=\"submitForm\">确 定</el-button>\r\n      <el-button @click=\"cancel\">取 消</el-button>\r\n    </div>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script>\r\nimport { listInfo, getInfo, delInfo, addInfo, updateInfo, upload } from \"@/api/config/banner\";\r\nimport { VueCropper } from \"vue-cropper\";\r\nimport store from \"@/store\";\r\n\r\nexport default {\r\n  name: \"Info\",\r\n  components: { VueCropper },\r\n  data () {\r\n    return {\r\n      // 遮罩层\r\n      loading: true,\r\n      // 选中数组\r\n      ids: [],\r\n      // 非单个禁用\r\n      single: true,\r\n      // 非多个禁用\r\n      multiple: true,\r\n      // 显示搜索条件\r\n      showSearch: true,\r\n      // 总条数\r\n      total: 0,\r\n      action: process.env.VUE_APP_BASE_API + \"/config/banner/upload\",\r\n      // 轮播组件表格数据\r\n      infoList: [],\r\n      // fileList: [{ name: 'food.jpeg', url: 'https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100' }, { name: 'food2.jpeg', url: 'https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100' }],\r\n      files: [],\r\n      // 弹出层标题\r\n      title: \"\",\r\n      // 是否显示弹出层\r\n      open: false,\r\n      // 查询参数\r\n      options: {\r\n        img: null, //裁剪图片的地址\r\n        autoCropWidth: 495, // 默认生成截图框宽度\r\n        autoCropHeight: 270, // 默认生成截图框高度\r\n        fixedNumber: [1.83333,1],\r\n        original:true\r\n      },\r\n      bannerWidth: '',\r\n      bannerHeight: '',\r\n      previews: {},\r\n\r\n      // 表单参数\r\n      form: {},\r\n      // 表单校验\r\n      rules: {\r\n        componentId: [\r\n          { required: true, message: \"组件ID不能为空\", trigger: \"blur\" }\r\n        ],\r\n        orderNum: [\r\n          { required: true, message: \"显示顺序不能为空\", trigger: \"blur\" }\r\n        ],\r\n\r\n      }\r\n    };\r\n  },\r\n  created () {\r\n    this.getList();\r\n  },\r\n  methods: {\r\n\r\n    httpRequest (option) {\r\n      this.files = [];\r\n      this.files.push(option)\r\n    },\r\n\r\n    // 向左旋转\r\n    rotateLeft () {\r\n      this.$refs.cropper.rotateLeft();\r\n    },\r\n    // 向右旋转\r\n    rotateRight () {\r\n      this.$refs.cropper.rotateRight();\r\n    },\r\n    // 图片缩放\r\n    changeScale (num) {\r\n      num = num || 1;\r\n      this.$refs.cropper.changeScale(num);\r\n    },\r\n\r\n    // 上传预处理\r\n    beforeUpload (file) {\r\n      if (file.type.indexOf(\"image/\") == -1) {\r\n        this.$modal.msgError(\"文件格式错误，请上传图片类型,如：JPG，PNG后缀的文件。\");\r\n      } else {\r\n        const reader = new FileReader();\r\n        reader.readAsDataURL(file);\r\n        reader.onload = () => {\r\n          this.options.img = reader.result;\r\n        };\r\n      }\r\n    },\r\n\r\n    // 实时预览\r\n    realTime (data) {\r\n      this.previews = data;\r\n    },\r\n\r\n\r\n\r\n\r\n\r\n\r\n    /** 查询轮播组件列表 */\r\n    getList () {\r\n      this.loading = true;\r\n      listInfo(this.queryParams).then(response => {\r\n        this.infoList = response.rows;\r\n        this.total = response.total;\r\n        this.loading = false;\r\n      });\r\n    },\r\n    // 取消按钮\r\n    cancel () {\r\n      this.open = false;\r\n      this.reset();\r\n    },\r\n    // 表单重置\r\n    reset () {\r\n      //清空上传控件文件信息\r\n      let uploadBanner = this.$refs.uploadBanner;\r\n      if (uploadBanner) {\r\n        this.$refs.uploadBanner.clearFiles();\r\n      }\r\n      this.files = [];\r\n\r\n      this.options.img = null;\r\n      this.form = {\r\n        id: null,\r\n        componentId: null,\r\n        filePath: null,\r\n        orderNum: 1,\r\n        createBy: null,\r\n        createTime: null,\r\n        updateBy: null,\r\n        updateTime: null,\r\n        delFlag: null\r\n      };\r\n      this.resetForm(\"form\");\r\n    },\r\n\r\n    // 多选框选中数据\r\n    handleSelectionChange (selection) {\r\n      this.ids = selection.map(item => item.id)\r\n      this.single = selection.length !== 1\r\n      this.multiple = !selection.length\r\n    },\r\n    /** 新增按钮操作 */\r\n    handleAdd () {\r\n      this.reset();\r\n      this.open = true;\r\n      this.title = \"添加轮播组件\";\r\n    },\r\n\r\n    base64ToBlob (base64) {\r\n      let parts = base64.split(\";base64,\");\r\n      let contentType = parts[0].split(\":\")[1];\r\n      let raw = window.atob(parts[1]);\r\n      let rawLength = raw.length;\r\n      let uInt8Array = new Uint8Array(rawLength);\r\n      for (let i = 0; i < rawLength; i += 1) {\r\n        uInt8Array[i] = raw.charCodeAt(i);\r\n      }\r\n      return new Blob([uInt8Array], { type: contentType });\r\n    },\r\n\r\n    /** 修改按钮操作 */\r\n    handleUpdate (row, _this) {\r\n      console.log(_this);\r\n      _this.reset();\r\n      const id = row.id || _this.ids\r\n      getInfo(id).then(response => {\r\n        _this.form = response.data;\r\n        _this.open = true;\r\n        _this.title = \"修改轮播组件\";\r\n        let fileBase64 = response.data.fileBase64;\r\n        if (fileBase64) {\r\n          _this.options.img = URL.createObjectURL(_this.base64ToBlob(fileBase64))\r\n        }\r\n        //this.files.push(option)\r\n\r\n      });\r\n    },\r\n    /** 提交按钮 */\r\n    submitForm () {\r\n      this.$refs[\"form\"].validate(valid => {\r\n        if (valid) {\r\n          let formData = new FormData();\r\n          this.$refs.cropper.getCropBlob(data => {\r\n            if (!data) {\r\n              this.$message.error(\"请上传文件\");\r\n              return;\r\n            }\r\n            formData.append(\"file\", data);\r\n            formData.append(\"componentId\", this.form.componentId)\r\n            formData.append(\"orderNum\", this.form.orderNum)\r\n            if (this.form.id != null) {\r\n              formData.append(\"id\", this.form.id);\r\n            }\r\n            upload(formData).then(response => {\r\n              if (response && response.data) {\r\n                this.$modal.msgSuccess(\"操作成功\");\r\n                this.open = false;\r\n                this.$parent.getList();\r\n              }\r\n\r\n            });\r\n          })\r\n\r\n        }\r\n      });\r\n    },\r\n    /** 删除按钮操作 */\r\n    handleDelete (row) {\r\n      const ids = row.id || this.ids;\r\n      this.$modal.confirm('是否确认删除轮播组件编号为\"' + ids + '\"的数据项？').then(function () {\r\n        return delInfo(ids);\r\n      }).then(() => {\r\n        this.getList();\r\n        this.$modal.msgSuccess(\"删除成功\");\r\n      }).catch(() => { });\r\n    },\r\n\r\n    // 关闭窗口\r\n    closeDialog () {\r\n      this.options.img = null\r\n      this.open = false;\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style scoped>\r\n.banner-upload-preview {\r\n  height: 100%;\r\n  box-shadow: 0 0 4px #ccc;\r\n  overflow: hidden;\r\n\r\n}\r\n</style>\r\n"]}]}